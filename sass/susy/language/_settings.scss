// Grid Syntax
// ===========
//
// Mixins:
// - set-grid()
// - use-grid()

// Set a new grid using a shorthand
@mixin set-grid(
  $grid,
  $clean: false
) {

  $grid               : parse-grid($grid);

  $new-columns        : nth($grid,1);
  $new-gutters        : nth($grid,2);
  $new-container      : nth($grid,3);
  $new-column-width   : nth($grid,4);
  $new-static         : nth($grid,5);
  $new-isolate        : nth($grid,6);
  $new-flow           : nth($grid,7);
  $new-show-grids     : nth($grid,8);

  @if not $clean {
    $new-columns          : if($new-columns, $new-columns, $columns);
    $new-gutters          : if($new-gutters, $new-gutters, $gutters);
    $new-container        : if($new-container, $new-container, $container);
    $new-column-width     : if($new-column-width, $new-column-width, $column-width);
    $new-static           : if($new-static, $new-static, $static);
    $new-isolate          : if($new-isolate, $new-isolate, $isolate);
  }

  $columns            : $new-columns;
  $gutters            : $new-gutters;
  $container          : $new-container;
  $column-width       : $new-column-width;
  $static             : $new-static;
  $isolate            : $new-isolate;
  $flow               : if($new-flow, $new-flow, $flow);
  $show-grids         : if($new-show-grids, $new-show-grids, $show-grids);
}

// Use an arbitrary grid for a section of code
@mixin use-grid(
  $grid,
  $clean: false
) {
  $old-grid: get-grid();

  @include set-grid($grid, $clean);
  @content;
  @include set-grid($old-grid, $clean);
}

// Grid helpers
// ------------

// Get the current grid settings as a shorthand list
@function get-grid(
) {
  $gutter-setting       : $gutters;
  $static-setting       : false;
  $isolate-setting      : false;
  $show-grids-setting   : false;

  // Use units for column/gutter ratio if available
  @if $column-width {
    $gutter-setting: $column-width $column-width * $gutters;
  }

  // Create keyword for static setting
  @if $static and $static != fluid {
    $static-setting: static;
  } @else {
    $static-setting: fluid;
  }

  // Create keyword for isolate setting
  @if $isolate and $isolate != float {
    $isolate-setting: isolate;
  } @else {
    $isolate-setting: float;
  }

  // Create keyword for show-grids setting
  @if $show-grids and $show-grids != hide {
    $show-grids-setting: show;
  } @else {
    $show-grids-setting: hide;
  }

  // Return grid shorthand
  @return compact($container $columns $gutter-setting $static-setting $isolate-setting $show-grids-setting $flow);
}

// Parse a shorthand grid, and return an ordered list of settings
@function parse-grid(
  $grid: get-grid()
) {
  $columns-setting        : false;
  $gutters-setting        : false;
  $container-setting      : false;
  $column-width-setting   : false;
  $static-setting         : false;
  $isolate-setting        : false;
  $flow-setting           : false;
  $show-setting           : false;

  $columns-check          : false;

  @each $value in $grid {
    @if type-of($value) == string {
      // output: static | fluid
      @if $value == static {
        $static-setting: static;
      } @else {
        $static-setting: fluid;
      }

      // output: isolate | fluid
      @if $value == isolate {
        $isolate-setting: isolate;
      } @else {
        $isolate-setting: float;
      }

      // flow: ltr | rtl
      @if $value == rtl {
        $flow-setting: rtl;
      } @else {
        $flow-setting: ltr;
      }

      // show-grid: show | hide
      @if $value == show {
        $show-setting: show;
      } @else {
        $show-setting: hide;
      }
    }

    // container, columns, or gutters
    @else if type-of($value) == number {
      @if not unitless($value) {
        $container-setting: $value;
      } @else if not $columns-check {
        $columns-setting: $value;
        $columns-check: true;
      } @else {
        $gutters-setting: $value;
      }
    }

    // columns or gutters
    @else if type-of($value) == list {
      @if unitless(nth($value,1)) {
        $columns-setting: $value;
        $columns-check: true;
      } @else {
        $column-width-setting: nth($value,1);
        $gutters-setting: nth($value,2) / nth($value,1);
      }
    }
  }

  @return $columns-setting $gutters-setting $container-setting $column-width-setting $static-setting $isolate-setting $flow-setting $show-setting;
}

// Return one setting from a shorhand grid
@function get-setting(
  $setting,
  $grid: get-grid()
) {
  $grid     : parse-grid($grid);
  $value    : false;

  $options  : columns gutters container column-width static isolate flow show-grids;
  $key      : index($options, $setting);

  @if $key {
    $value: nth($grid, $key);
  }

  @return $value;
}
